<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<title>Search springfiles.com</title>
<script type="text/javascript">
/*jslint browser: true */


    var timer, query;
    function FocusOnInput() {
        document.getElementById("search").focus();
    }

    function showResult(str) {
        var xmlhttp;
        if (str.length === 0) {
            document.getElementById("livesearch").innerHTML = "";
            document.getElementById("livesearch").style.border = "0px";
            return;
        }
        if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {// code for IE6, IE5
            xmlhttp = new window.ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
 		var objs = JSON.parse(xmlhttp.responseText);
		var html = "<ul>";
		for (const k in objs) {
			html += "<li>";
			html += "<h2>" + objs[k]["springname"] + "</h2>";
			if ("mirrors" in objs[k] && "0" in objs[k]["mirrors"]) {
				html += '<a href="' + objs[k]["mirrors"][0] + '">download</a><br/>';
			}
			if ("mapimages" in objs[k]) {
				html += '<img src="' + objs[k]["mapimages"][0] + '"</img>';
			}
			html += objs[k]["category"];
			html += "</li>";
		}
		html += "</ul>";
                document.getElementById("livesearch").innerHTML = html;
                document.getElementById("livesearch").style.border = "1px solid #A5ACB2";
            }
        }
        xmlhttp.open("GET","json.php?nosensitive=on&images=on&springname=*" + str + "*" ,true);
        xmlhttp.send();
    }
    function validate() {
        showResult(query);
    }
    function chk_me(str){
        query = str;
	if (str == "") {
            showResult("");
            return;
        }
        clearTimeout(timer);
        timer = setTimeout(validate,800);
    }

    function setSearch() {
	if (window.location.hash) {
      var hash = window.location.hash.substring(1); //Puts hash in variable, and removes the # character
		document.getElementById('search').value = hash;
		showResult(hash);
	}
	}
//-->
</script>
</head>
<body onload="FocusOnInput(); setSearch();">

<form action="#">
<input type="text" id="search" size="30" onkeyup="chk_me(this.value)" onkeypress="if(event.keyCode==13) { showResult(this.value); return false; }" />
<div id="livesearch"></div>
</form>

</body>
</html>

